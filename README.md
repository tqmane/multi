# Multi Window Patch

Android用のXposed/LSPosedモジュールで、すべてのアプリでマルチウィンドウ機能を強制的に有効化し、アプリ起動中に常時通知を表示してマルチウィンドウモードへの切り替えを簡単にします。

## 概要

Android 7.0 (Nougat)以降で導入されたマルチウィンドウ機能は、一部のアプリでは無効化されています。このモジュールは、システムレベルでマルチウィンドウのチェックをバイパスし、すべてのアプリでマルチウィンドウを使用可能にします。

さらに、アプリが起動している間は**常時サイレント通知**を表示し、通知のボタンからワンタップでマルチウィンドウモードを開くことができます。

## 機能

- ✅ すべてのアプリでマルチウィンドウを強制的に有効化
- ✅ 分割画面モードのサポート
- ✅ フリーフォームウィンドウモードのサポート（Android 11以降）
- ✅ **アプリ起動中に常時サイレント通知を表示**
- ✅ **通知からワンタップでマルチウィンドウモードを開く**
- ✅ システム全体に適用されるため、アプリごとの設定不要

## 必要要件

- Android 7.0 (API 24) 以降
- Root化されたデバイス
- LSPosed または Xposed Framework

## インストール方法

### 1. ビルド方法

```bash
# プロジェクトをクローン
git clone <repository-url>
cd multi

# Gradleでビルド
./gradlew assembleRelease
```

ビルドされたAPKは `app/build/outputs/apk/release/` に生成されます。

### 2. インストール

1. ビルドしたAPKをデバイスにインストール
2. LSPosed/Xposedマネージャーを開く
3. モジュール一覧で「Multi Window Patch」を有効化
4. スコープで「System Framework (android)」が選択されていることを確認
5. デバイスを再起動

## 使用方法

### 通知からマルチウィンドウを開く（推奨）

1. モジュールを有効化して再起動
2. 任意のアプリを起動すると、自動的にサイレント通知が表示されます
3. 通知を下にスワイプして展開
4. **「マルチウィンドウで開く」**ボタンをタップ
5. アプリがマルチウィンドウモードで起動します

### 従来の方法

1. モジュールを有効化して再起動後、自動的にすべてのアプリでマルチウィンドウが有効になります
2. 通常通りマルチウィンドウ機能を使用できます：
   - 最近のアプリボタンから分割画面モードを選択
   - アプリアイコンを長押ししてフリーフォームモードを選択（対応デバイスのみ）

### 通知について

- **サイレント通知**: 音や振動はありません
- **常時表示**: アプリが起動している間、通知パネルに常に表示されます
- **自動非表示**: アプリを終了すると通知も自動的に消えます
- **除外アプリ**: システムアプリ（設定、SystemUIなど）では通知は表示されません

## 技術詳細

このモジュールは以下の方法でマルチウィンドウを有効化します：

### システムフレームワークのフック

1. **ActivityInfo.isResizeable()のフック**: すべてのアクティビティがリサイズ可能であると報告
2. **ActivityRecordのフック**: アクティビティ作成時にresizeModeを強制的に変更
3. **PackageParserのフック**: パッケージ情報解析時にマルチウィンドウフラグを設定

### アプリライフサイクルの監視

1. **Activity.onResume()のフック**: アプリが前面に来た時に通知を表示
2. **Activity.onPause()のフック**: アプリがバックグラウンドに行った時の処理
3. **Activity.onDestroy()のフック**: アプリ終了時に通知を削除

### 通知システム

1. **フォアグラウンドサービス**: 通知を常時表示するためのサービス
2. **BroadcastReceiver**: 通知のボタンからマルチウィンドウを開くためのレシーバー
3. **サイレント通知チャンネル**: 音や振動なしで通知を表示

## 注意事項

⚠️ **警告**: 
- 一部のアプリは意図的にマルチウィンドウを無効化しています（セキュリティ、UI/UX上の理由など）
- マルチウィンドウモードで正しく動作しないアプリがある可能性があります
- 画面レイアウトが崩れる、機能が正常に動作しないなどの問題が発生する場合があります
- **通知の表示**: すべてのアプリで通知が表示されます。不要な場合は通知設定で無効化できます
- **Android 13以降**: 通知権限の許可が必要な場合があります
- 使用は自己責任でお願いします

### 通知を無効化したい場合

1. Androidの設定を開く
2. アプリ > Multi Window Patch > 通知
3. 「マルチウィンドウ」チャンネルを無効化

※ 通知を無効化しても、マルチウィンドウ機能自体は有効のままです。

## トラブルシューティング

### モジュールが動作しない場合

1. LSPosed/Xposedマネージャーでモジュールが有効化されているか確認
2. スコープに「System Framework (android)」が含まれているか確認
3. デバイスを再起動したか確認
4. LSPosedのログを確認（設定 > ログ）

### 通知が表示されない場合

1. Android 13以降：通知権限が許可されているか確認
2. アプリの通知設定で「マルチウィンドウ」チャンネルが有効か確認
3. システムの「通知を表示しない」モードになっていないか確認
4. LSPosedのログでエラーが出ていないか確認

### マルチウィンドウボタンが動作しない場合

1. 通知を展開してボタンが表示されているか確認
2. 別のアプリが既に起動しているか確認（分割画面には2つのアプリが必要）
3. デバイスがマルチウィンドウをサポートしているか確認（Android 7.0以降）

### 特定のアプリで問題が発生する場合

一部のアプリでは、マルチウィンドウモードで正しく動作しない場合があります。その場合は：
- アプリを全画面モードで使用する
- アプリ開発者にマルチウィンドウ対応を要望する
- 必要に応じてMainHook.javaの除外リストに追加

## ライセンス

このプロジェクトはMITライセンスの下で公開されています。

## 貢献

バグレポートやプルリクエストは大歓迎です！

## 免責事項

このモジュールの使用により発生したいかなる問題についても、開発者は責任を負いません。使用は自己責任でお願いします。
